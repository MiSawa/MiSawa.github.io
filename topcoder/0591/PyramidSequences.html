<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>TopCoder SRM591 Div1 Med 500 PyramidSequences - みさわめも</title>

    <meta itemprop="name" content="TopCoder SRM591 Div1 Med 500 PyramidSequences" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@Mi_Sawa" />
    <meta name="twitter:title" content="TopCoder SRM591 Div1 Med 500 PyramidSequences" />
    <meta name="twitter:creator" content="@Mi_Sawa" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="TopCoder SRM591 Div1 Med 500 PyramidSequences" />
    <meta property="og:site_name" content="みさわめも" />
    <meta property="og:locale" content="ja_JP" />
    <link href="/stylesheets/normalize-9D68B9A1.css" rel="stylesheet" />
    <link href="/stylesheets/all-BE4B6E2E.css" rel="stylesheet" />
    
    <script>
      window.WebFontConfig = {
        custom: {
          families: ['KaTeX_AMS', 'KaTeX_Caligraphic:n4,n7', 'KaTeX_Fraktur:n4,n7',
            'KaTeX_Main:n4,n7,i4,i7', 'KaTeX_Math:i4,i7', 'KaTeX_Script',
            'KaTeX_SansSerif:n4,n7,i4', 'KaTeX_Size1', 'KaTeX_Size2', 'KaTeX_Size3',
            'KaTeX_Size4', 'KaTeX_Typewriter'],
        },
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.js" integrity="sha256-4O4pS1SH31ZqrSO2A/2QJTVjTPqVe+jnYgOWUVr7EEc=" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
          delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false},
            {left: "\\[", right: "\\]", display: true},
          ],
          macros: {
            // '\\N': '{\\mathbb{N}}',
            // '\\Z': '{\\mathbb{Z}}',
            '\\Q': '{\\mathbb{Q}}',
            // '\\R': '{\\mathbb{R}}',
            '\\C': '{\\mathbb{C}}',
            '\\divides': '{\\mid}',
            '\\abs': '{\\left| #1 \\right|}',
            '\\relmiddle': '\\mathrel{}\\middle#1\\mathrel{}',
            '\\setmid': '\\relmiddle|',
            '\\set': '\\left\\{\\,#1\\,\\right\\}',
          },
        });
      });
    </script>
    
  </head>
  <body>
    <header>
      <input id='nav-hamburger-checkbox' type='checkbox' />
      <label id='nav-hamburger-button' for='nav-hamburger-checkbox'>
        <svg id="menu-toggle-icon" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" height="32px" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <title>Icon to toggle menu</title>
          <g class='hamburger' fill="none" stroke="black" stroke-width="4">
            <path stroke-linecap="round" d="M4,8h24"/>
            <path stroke-linecap="round" d="M4,16h24"/>
            <path stroke-linecap="round" d="M4,24h24"/>
          </g>
          <g class='close' fill="none" stroke="black" stroke-width="4">
            <path stroke-linecap="round" d="M8,8l16,16"/>
            <path stroke-linecap="round" d="M8,24l16,-16"/>
          </g>
      </label>
      <nav>
        <ul>
            <li><a href="/index.html">Top</a></li>
            <li><a href="/contests.html">Contests</a></li>
            <li><a href="/others/index.html">Articles</a></li>
            <li><a href="/tags/index.html">Tags</a></li>
            <li><a href="/about.html">About</a></li>
      </nav>
    </header>
    <main>
      <article><h2>TopCoder SRM591 Div1 Med 500 PyramidSequences</h2>
    <a href="http://community.topcoder.com/stat?c=problem_statement&pm=12619&rd=15703">問題文</a><h3>概要</h3>
<p>$ X $ に対し, 高さ $ X $ のピラミッド列とは,</p>
<p>$ (1, 2, \dots, X-1, X, X-1, \dots, 2) $</p>
<p>の $ 2X - 2 $ 個の無限繰り返しを指す.</p>
<p>高さ $ N $ と $ M $ のピラミッド列 $ A $ と $ B $ が, (左端の $ 1 $ が並ぶようにして) おいてある.</p>
<p>$ (A_i, B_i) $ のペアとしてありうる組合せを数え上げよ.</p>
<h4>制約</h4>
<p>$ 1 \le N, M \le 10^9$.</p>
<h3>解法</h3>
<p>ここより <a href="http://apps.topcoder.com/wiki/display/tc/SRM+591">editorial</a> を見たほうがよい.
まだ読んでないけど, ここよりずっと綺麗っぽい.</p>
<p>$ 1, \dots, N, \dots, 1 $ じゃなくて $ 0, \dots, N-1, \dots, 0 $ にしとく.</p>
<p>$ \gcd(2N-2, 2M-2) $ まで取ると, 左右対称なので,
とりあえず, $ A $ が増加している部分だけ考えればよい.</p>
<p>それぞれの周期を $ a = 2N - 2,\ b = 2 M - 2 $ とする.</p>
<p>$ t $ が $ A $ の増加部分で現れるのは, $ t, t + a, t + 2a, \dots $ 番目.</p>
<p>$ t $ が現れる index を $ \bmod b $ した値は,
$$ t + ka \equiv i \mod b \\ \Leftrightarrow i - t \equiv k a \mod b $$
だから, $ g = \gcd(a, b) $ として, $ i - t \equiv 0 \mod g $ になる.</p>
<p>逆にこのときは, $ (x - t) / g \equiv k (a / g) \mod (b / g) $ で, $ a/g $ の $ \bmod (b/g) $ の逆元を両辺にかけて $ k $ を復元出来るから, 実際にそこにもってこれる.</p>
<p>一方, $ B_i $ は, $ i \bmod b &lt; b/2 $ か否かに従って $ i \bmod b $ か $ -i \bmod b $.</p>
<p>よって, $ (t, x) $ が現れうるのは, $ t \equiv \pm x \mod g $ のとき.</p>
<p>よって,</p>
<pre class="highlight" style="margin:0.8em;background-color:#49483e;"><code class="highlight"><table class="highlight"><tbody><tr><td class="lineno" style="padding-left:0.5em;padding-right:0.5em;border-left:1px solid #000;"><pre class="lineno" style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;color:#f8f8f2;">1
2</pre></td><td class="code" style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;padding-left:0.5em;padding-right:0.5em;border-left:1px solid #000;"><pre style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;white-space:pre;"><span style="color:#c6c5fe;">rep</span><span style="color:#ffffff;">(i, N) </span><span style="color:#f8f8f8;">rep</span><span style="color:#ffffff;">(</span><span style="color:#c6c5fe;">j</span><span style="color:#ffffff;">, </span><span style="color:#c6c5fe;">M</span><span style="color:#ffffff;">) </span><span style="color:#66ccff;">if</span><span style="color:#ffffff;">((i</span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;">j)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g </span><span style="color:#aaaaaa;">== </span><span style="font-weight:bold;color:#ff73fd;">0 </span><span style="color:#aaaaaa;">or </span><span style="color:#ffffff;">(i</span><span style="color:#aaaaaa;">+</span><span style="color:#ffffff;">j)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g </span><span style="color:#aaaaaa;">== </span><span style="font-weight:bold;color:#ff73fd;">0</span><span style="color:#ffffff;">)
</span><span style="color:#ffffff;">    </span><span style="color:#aaaaaa;">++</span><span style="color:#ffffff;">res;</span></pre></td></tr></tbody></table></code></pre>
<p>というのは正しい答えを返す.</p>
<p>あとは, $ i $ を固定した時に $ i \equiv j \mod g $ の解と $ i \equiv -j \mod g $ の解が一致するか否かで場合分けしつつ, ループを一重に落とせる.</p>
<pre class="highlight" style="margin:0.8em;background-color:#49483e;"><code class="highlight"><table class="highlight"><tbody><tr><td class="lineno" style="padding-left:0.5em;padding-right:0.5em;border-left:1px solid #000;"><pre class="lineno" style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;color:#f8f8f2;">1
2
3
4
5
6
7</pre></td><td class="code" style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;padding-left:0.5em;padding-right:0.5em;border-left:1px solid #000;"><pre style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;white-space:pre;"><span style="color:#c6c5fe;">rep</span><span style="color:#ffffff;">(i, N){
</span><span style="color:#ffffff;">    </span><span style="color:#66ccff;">if</span><span style="color:#ffffff;">((i</span><span style="color:#aaaaaa;">*</span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">== </span><span style="font-weight:bold;color:#ff73fd;">0</span><span style="color:#ffffff;">){
</span><span style="color:#ffffff;">        res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;">(i</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g))</span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;">g</span><span style="color:#aaaaaa;">+</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">    }</span><span style="color:#66ccff;">else</span><span style="color:#ffffff;">{
</span><span style="color:#ffffff;">        res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">- </span><span style="color:#ffffff;">(i</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g)) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">+ </span><span style="color:#ffffff;">(M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">- </span><span style="color:#ffffff;">((g</span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;">i</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g)) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">    }
</span><span style="color:#ffffff;">}</span></pre></td></tr></tbody></table></code></pre>
<p>これは明らかに $ \bmod g $ で周期的な挙動をするから, $ g $ が小さい時は周期でスキップすればよい.</p>
<p>一方, $ g $ が大きいときは, <code>(M - 1 - (i%g)) / g</code> などの変わり目がすぐにわかることを利用して, <code>+= g</code> のタイプのスキップをすると楽.</p>
<p>(端っこが面倒だからこういうスキップをしているだけで, 算数をすると, いちおう $ O(1) $ には出来る)</p>
<p>あと, なんか $N = M$ のときコーナーケースになっていた.
どこの議論か追う気力がない.</p>
<h3>ソースコード</h3>
<pre class="highlight" style="margin:0.8em;background-color:#49483e;"><code class="highlight"><table class="highlight"><tbody><tr><td class="lineno" style="padding-left:0.5em;padding-right:0.5em;border-left:1px solid #000;"><pre class="lineno" style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;color:#f8f8f2;">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre></td><td class="code" style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;padding-left:0.5em;padding-right:0.5em;border-left:1px solid #000;"><pre style="padding-top:0;padding-bottom:0;margin-top:0;margin-bottom:0;white-space:pre;"><span style="background-color:#212121;color:#7c7c7c;">/*
</span><span style="background-color:#212121;color:#7c7c7c;">   A 側の増加部分だけ考えればいい. (逆から見ても同じペアになるはずだから).
</span><span style="background-color:#212121;color:#7c7c7c;">   a = 2N-2, b = 2M-2 とする.
</span><span style="background-color:#212121;color:#7c7c7c;">   0 1 2 ... N-1 N-2 ... 0 と思う.
</span><span style="background-color:#212121;color:#7c7c7c;">
</span><span style="background-color:#212121;color:#7c7c7c;">   t が現れるのは,
</span><span style="background-color:#212121;color:#7c7c7c;">      t, t+a, ..., t + ab
</span><span style="background-color:#212121;color:#7c7c7c;">   番目.
</span><span style="background-color:#212121;color:#7c7c7c;">   i 番目の B の値は,
</span><span style="background-color:#212121;color:#7c7c7c;">      i % b &lt; b/2 なら  i % b
</span><span style="background-color:#212121;color:#7c7c7c;">      そうでないなら  (-i) % b
</span><span style="background-color:#212121;color:#7c7c7c;">
</span><span style="background-color:#212121;color:#7c7c7c;">    (t + ka) == x mod b
</span><span style="background-color:#212121;color:#7c7c7c;">   &lt;=&gt;
</span><span style="background-color:#212121;color:#7c7c7c;">    x - t == ka mod b
</span><span style="background-color:#212121;color:#7c7c7c;">   だから,
</span><span style="background-color:#212121;color:#7c7c7c;">     x - t : gcd(a, b) の倍数.
</span><span style="background-color:#212121;color:#7c7c7c;">   g = gcd(a, b) とすると,
</span><span style="background-color:#212121;color:#7c7c7c;">   要するに, (t, x) となりうる x は,
</span><span style="background-color:#212121;color:#7c7c7c;">     g | (x - t)
</span><span style="background-color:#212121;color:#7c7c7c;">      or
</span><span style="background-color:#212121;color:#7c7c7c;">     g | (x + t)
</span><span style="background-color:#212121;color:#7c7c7c;">   なやつら.
</span><span style="background-color:#212121;color:#7c7c7c;">
</span><span style="background-color:#212121;color:#7c7c7c;">   g | (x-t) かつ g | (x+t) となるには, g | 2t が必要で,
</span><span style="background-color:#212121;color:#7c7c7c;">   この時は
</span><span style="background-color:#212121;color:#7c7c7c;">    x == t == -t mod g
</span><span style="background-color:#212121;color:#7c7c7c;">   よって, x == (t%g) な 0 &lt;= x &lt; M の個数 = (M - 1 - (t%g))/g + 1
</span><span style="background-color:#212121;color:#7c7c7c;">
</span><span style="background-color:#212121;color:#7c7c7c;">   そうでないとき,
</span><span style="background-color:#212121;color:#7c7c7c;">     x == t mod g
</span><span style="background-color:#212121;color:#7c7c7c;">     or
</span><span style="background-color:#212121;color:#7c7c7c;">     x == -t mod g
</span><span style="background-color:#212121;color:#7c7c7c;">    (M - 1 - (t%g)) / g + 1
</span><span style="background-color:#212121;color:#7c7c7c;">    +
</span><span style="background-color:#212121;color:#7c7c7c;">    (M - 1 - ((g-t%g)%g)) / g + 1
</span><span style="background-color:#212121;color:#7c7c7c;">*/</span><span style="color:#ffffff;">
</span><span style="color:#ffffff;">
</span><span style="background-color:#212121;color:#7c7c7c;">// 150.0 pts
</span><span style="color:#ffffff;">
</span><span style="color:#cfcb90;">long long </span><span style="color:#f8f8f8;">PyramidSequences::distinctPairs</span><span style="color:#ffffff;">( </span><span style="color:#cfcb90;">int </span><span style="color:#c6c5fe;">N_</span><span style="color:#ffffff;">, </span><span style="color:#cfcb90;">int </span><span style="color:#c6c5fe;">M_ </span><span style="color:#ffffff;">){</span><span style="background-color:#212121;color:#7c7c7c;">//{{{
</span><span style="color:#ffffff;">    </span><span style="color:#cfcb90;">long long</span><span style="color:#ffffff;"> N </span><span style="color:#aaaaaa;">=</span><span style="color:#ffffff;"> N_, M </span><span style="color:#aaaaaa;">=</span><span style="color:#ffffff;"> M_;
</span><span style="color:#ffffff;">    </span><span style="color:#66ccff;">if</span><span style="color:#ffffff;">(M </span><span style="color:#aaaaaa;">==</span><span style="color:#ffffff;"> N) </span><span style="color:#66ccff;">return</span><span style="color:#ffffff;"> M;
</span><span style="color:#ffffff;">    </span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;"> a </span><span style="color:#aaaaaa;">= </span><span style="font-weight:bold;color:#ff73fd;">2 </span><span style="color:#aaaaaa;">*</span><span style="color:#ffffff;"> N </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">, b </span><span style="color:#aaaaaa;">= </span><span style="font-weight:bold;color:#ff73fd;">2 </span><span style="color:#aaaaaa;">*</span><span style="color:#ffffff;"> M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">    </span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">= </span><span style="color:#c6c5fe;">__gcd</span><span style="color:#ffffff;">(a, b);
</span><span style="color:#ffffff;">    </span><span style="color:#cfcb90;">long long</span><span style="color:#ffffff;"> res </span><span style="color:#aaaaaa;">= </span><span style="font-weight:bold;color:#ff73fd;">0</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">// rep(i, N) rep(j, M) if((i-j)%g == 0 or (i+j)%g == 0)//{{{
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     ++res;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">// rep(i, N){
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     int cnt = 0;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     rep(j, M) if((i-j)%g == 0 or (i+j)%g == 0)
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//         ++cnt;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     cout &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; cnt &lt;&lt; endl;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     if((i*2)%g == 0){
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//         cout &lt;&lt; (M-1-(i%g))/g+1 &lt;&lt; endl;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     }else{
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//         cout &lt;&lt; (M - 1 - (i%g)) / g + 1 + (M - 1 - ((g-i%g)%g)) / g + 1 &lt;&lt; endl;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     }
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">//     // cout &lt;&lt; (i*2 % g == 0 ? (a-1)/g : (a-1)/g*2) &lt;&lt; endl;
</span><span style="color:#ffffff;">    </span><span style="background-color:#212121;color:#7c7c7c;">// }//}}}
</span><span style="color:#ffffff;">    </span><span style="color:#66ccff;">if</span><span style="color:#ffffff;">(g </span><span style="color:#aaaaaa;">&gt; </span><span style="font-weight:bold;color:#ff73fd;">100000</span><span style="color:#ffffff;">){
</span><span style="color:#ffffff;">        res </span><span style="color:#aaaaaa;">-= </span><span style="color:#ffffff;">((N </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">* </span><span style="color:#ffffff;">((M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">        res </span><span style="color:#aaaaaa;">-= </span><span style="color:#ffffff;">((N </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> g</span><span style="color:#aaaaaa;">/</span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">* </span><span style="color:#ffffff;">((M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> g</span><span style="color:#aaaaaa;">/</span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// M-1-(i%g) == 0 &lt;=&gt; i == M-1 mod g
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// [0, (M-1)%g+1) は (M-1) / g + 1
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// [(M-1)%g+1, g) は (M-1) / g.
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// rep(i, N){
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//     res += (M - 1 - (i%g)) / g + 1;
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// }
</span><span style="color:#ffffff;">        </span><span style="color:#66ccff;">for</span><span style="color:#ffffff;">(</span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;"> i </span><span style="color:#aaaaaa;">= </span><span style="font-weight:bold;color:#ff73fd;">0</span><span style="color:#ffffff;">; i </span><span style="color:#aaaaaa;">&lt;</span><span style="color:#ffffff;"> N; i </span><span style="color:#aaaaaa;">+=</span><span style="color:#ffffff;"> g){
</span><span style="color:#ffffff;">            </span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;"> l </span><span style="color:#aaaaaa;">=</span><span style="color:#ffffff;"> i, r </span><span style="color:#aaaaaa;">= </span><span style="color:#c6c5fe;">min</span><span style="color:#ffffff;">&lt;</span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;">&gt;(N, i </span><span style="color:#aaaaaa;">+ </span><span style="color:#ffffff;">(M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">            res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(r </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> l) </span><span style="color:#aaaaaa;">* </span><span style="color:#ffffff;">((M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">            l </span><span style="color:#aaaaaa;">=</span><span style="color:#ffffff;"> r; r </span><span style="color:#aaaaaa;">= </span><span style="color:#c6c5fe;">min</span><span style="color:#ffffff;">&lt;</span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;">&gt;(N, i </span><span style="color:#aaaaaa;">+</span><span style="color:#ffffff;"> g);
</span><span style="color:#ffffff;">            res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(r </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> l) </span><span style="color:#aaaaaa;">* </span><span style="color:#ffffff;">((M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g);
</span><span style="color:#ffffff;">        }
</span><span style="color:#ffffff;">
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// M - 1 + i == 0 &lt;=&gt; i == 1-M mod g
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// [0, ((1-M)%g+g)%g+1) は (M-1)/g+1
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// [((1-M)%g+g)%g+1, g) は (M-1)/g
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// rep(i, N){
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//     res += (M - 1 - ((g-i%g)%g)) / g + 1;
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// }
</span><span style="color:#ffffff;">        </span><span style="color:#66ccff;">for</span><span style="color:#ffffff;">(</span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;"> i </span><span style="color:#aaaaaa;">= </span><span style="font-weight:bold;color:#ff73fd;">0</span><span style="color:#ffffff;">; i </span><span style="color:#aaaaaa;">&lt;</span><span style="color:#ffffff;"> N; i </span><span style="color:#aaaaaa;">+=</span><span style="color:#ffffff;"> g){
</span><span style="color:#ffffff;">            </span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;"> l </span><span style="color:#aaaaaa;">=</span><span style="color:#ffffff;"> i, r </span><span style="color:#aaaaaa;">= </span><span style="color:#c6c5fe;">min</span><span style="color:#ffffff;">&lt;</span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;">&gt;(N, i </span><span style="color:#aaaaaa;">+ </span><span style="color:#ffffff;">((</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;">M)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g</span><span style="color:#aaaaaa;">+</span><span style="color:#ffffff;">g)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g</span><span style="color:#aaaaaa;">+</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">            res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(r </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> l) </span><span style="color:#aaaaaa;">* </span><span style="color:#ffffff;">((M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g</span><span style="color:#aaaaaa;">+</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">            l </span><span style="color:#aaaaaa;">=</span><span style="color:#ffffff;"> r; r </span><span style="color:#aaaaaa;">= </span><span style="color:#c6c5fe;">min</span><span style="color:#ffffff;">&lt;</span><span style="color:#cfcb90;">int</span><span style="color:#ffffff;">&gt;(N, i </span><span style="color:#aaaaaa;">+</span><span style="color:#ffffff;"> g);
</span><span style="color:#ffffff;">            res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(r </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> l) </span><span style="color:#aaaaaa;">* </span><span style="color:#ffffff;">((M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g);
</span><span style="color:#ffffff;">        }
</span><span style="color:#ffffff;">
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// rep(i, N){
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//     if((i*2) % g == 0){
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//         res += (M-1-(i%g))/g+1;
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//     }else{
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//         res += (M - 1 - (i%g)) / g + 1;
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//         res += (M - 1 - ((g-i%g)%g)) / g + 1;
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">//     }
</span><span style="color:#ffffff;">        </span><span style="background-color:#212121;color:#7c7c7c;">// }
</span><span style="color:#ffffff;">    }</span><span style="color:#66ccff;">else</span><span style="color:#ffffff;">{
</span><span style="color:#ffffff;">        </span><span style="color:#c6c5fe;">rep</span><span style="color:#ffffff;">(i, N){
</span><span style="color:#ffffff;">            </span><span style="color:#66ccff;">if</span><span style="color:#ffffff;">(i </span><span style="color:#aaaaaa;">==</span><span style="color:#ffffff;"> g</span><span style="color:#aaaaaa;">*</span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">){
</span><span style="color:#ffffff;">                </span><span style="color:#cfcb90;">long long</span><span style="color:#ffffff;"> cnt </span><span style="color:#aaaaaa;">= </span><span style="color:#ffffff;">(N </span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;"> i) </span><span style="color:#aaaaaa;">/ </span><span style="color:#ffffff;">(g</span><span style="color:#aaaaaa;">*</span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">);
</span><span style="color:#ffffff;">                </span><span style="color:#66ccff;">while</span><span style="color:#ffffff;">(cnt </span><span style="color:#aaaaaa;">*</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">* </span><span style="font-weight:bold;color:#ff73fd;">2 </span><span style="color:#aaaaaa;">+</span><span style="color:#ffffff;"> i </span><span style="color:#aaaaaa;">&gt;=</span><span style="color:#ffffff;"> N) </span><span style="color:#aaaaaa;">--</span><span style="color:#ffffff;">cnt;
</span><span style="color:#ffffff;">                i </span><span style="color:#aaaaaa;">+=</span><span style="color:#ffffff;"> cnt </span><span style="color:#aaaaaa;">*</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">* </span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">                res </span><span style="color:#aaaaaa;">+=</span><span style="color:#ffffff;"> cnt </span><span style="color:#aaaaaa;">*</span><span style="color:#ffffff;"> res;
</span><span style="color:#ffffff;">            }
</span><span style="color:#ffffff;">            </span><span style="color:#66ccff;">if</span><span style="color:#ffffff;">((i</span><span style="color:#aaaaaa;">*</span><span style="font-weight:bold;color:#ff73fd;">2</span><span style="color:#ffffff;">) </span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">== </span><span style="font-weight:bold;color:#ff73fd;">0</span><span style="color:#ffffff;">){
</span><span style="color:#ffffff;">                res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(M</span><span style="color:#aaaaaa;">-</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;">(i</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g))</span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;">g</span><span style="color:#aaaaaa;">+</span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">            }</span><span style="color:#66ccff;">else</span><span style="color:#ffffff;">{
</span><span style="color:#ffffff;">                res </span><span style="color:#aaaaaa;">+= </span><span style="color:#ffffff;">(M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">- </span><span style="color:#ffffff;">(i</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g)) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">+ </span><span style="color:#ffffff;">(M </span><span style="color:#aaaaaa;">- </span><span style="font-weight:bold;color:#ff73fd;">1 </span><span style="color:#aaaaaa;">- </span><span style="color:#ffffff;">((g</span><span style="color:#aaaaaa;">-</span><span style="color:#ffffff;">i</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g)</span><span style="color:#aaaaaa;">%</span><span style="color:#ffffff;">g)) </span><span style="color:#aaaaaa;">/</span><span style="color:#ffffff;"> g </span><span style="color:#aaaaaa;">+ </span><span style="font-weight:bold;color:#ff73fd;">1</span><span style="color:#ffffff;">;
</span><span style="color:#ffffff;">            }
</span><span style="color:#ffffff;">        }
</span><span style="color:#ffffff;">    }
</span><span style="color:#ffffff;">    </span><span style="color:#66ccff;">return</span><span style="color:#ffffff;"> res;
</span><span style="color:#ffffff;">}</span><span style="background-color:#212121;color:#7c7c7c;">//}}}</span></pre></td></tr></tbody></table></code></pre></article>
      <footer>
        <h3>Tags</h3>
          <div class='tag'><a href="/tags/TopCoder.html">TopCoder (48)</a></div>
          <div class='tag'><a href="/tags/%E6%95%B4%E6%95%B0.html">整数 (1)</a></div>
      </footer>
    </main>
  </body>
</html>
